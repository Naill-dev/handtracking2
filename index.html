<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sad…ô ∆èl ƒ∞zl…ôm…ô</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .camera-box {
            background: #16213e;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .video-wrapper {
            position: relative;
            width: 100%;
            max-width: 640px;
            margin: 0 auto;
            border-radius: 15px;
            overflow: hidden;
            background: #0f0f1f;
        }

        #video, #canvas {
            width: 100%;
            height: auto;
            display: block;
        }

        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            background: #0f3460;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #533483;
            transform: translateY(-2px);
        }

        .btn.success {
            background: #28a745;
        }

        .btn.danger {
            background: #dc3545;
        }

        .status {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: #16213e;
            border-radius: 10px;
            color: #fff;
        }

        #status-text {
            color: #ffd700;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .info {
            margin-top: 20px;
            padding: 15px;
            background: #16213e;
            border-radius: 10px;
            color: #fff;
        }

        .info h3 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .info ul {
            list-style: none;
        }

        .info li {
            margin: 8px 0;
            color: #aaa;
        }

        .info li::before {
            content: "‚úì ";
            color: #28a745;
            font-weight: bold;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üñêÔ∏è Sad…ô ∆èl ƒ∞zl…ôm…ô</h1>
        
        <div class="camera-box">
            <div class="video-wrapper">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas"></canvas>
            </div>
            
            <div class="controls">
                <button class="btn success" onclick="startCamera()">üì∑ Kameranƒ± Ba≈ülat</button>
                <button class="btn danger" onclick="stopCamera()">‚èπÔ∏è Kameranƒ± Dayandƒ±r</button>
                <button class="btn" onclick="captureImage()">üì∏ ≈û…ôkil √á…ôk</button>
            </div>

            <div class="status">
                <p>Status: <span id="status-text">Kamera g√∂zl…ôyir</span></p>
                <p id="camera-info"></p>
            </div>

            <div class="info">
                <h3>üìã ƒ∞stifad…ô qaydalarƒ±:</h3>
                <ul>
                    <li>"Kameranƒ± Ba≈ülat" d√ºym…ôsin…ô klikl…ôyin</li>
                    <li>Brauzer icaz…ô ist…ôy…ôc…ôk - "ƒ∞caz…ô ver" se√ßin</li>
                    <li>Kamera a√ßƒ±lacaq v…ô ekranda g√∂r√ºn…ôc…ôksiniz</li>
                    <li>∆èlinizi kameraya g√∂st…ôrin</li>
                    <li>Qƒ±rmƒ±zƒ± n√∂qt…ôl…ôr barmaqlarƒ±nƒ±zƒ± izl…ôy…ôc…ôk</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1675469241/hands.js"></script>
    
    <script>
        // Elementl…ôri se√ß
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const statusText = document.getElementById('status-text');
        const cameraInfo = document.getElementById('camera-info');

        // D…ôyi≈ü…ônl…ôr
        let hands = null;
        let isCameraActive = false;
        let animationFrame = null;

        // ========== KAMERANI BA≈ûLAT ==========
        async function startCamera() {
            try {
                statusText.textContent = 'Kamera ba≈üladƒ±lƒ±r...';
                
                // Kamera stream-i al
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user'
                    } 
                });
                
                // Video elementin…ô t…ôyin et
                video.srcObject = stream;
                
                // Video hazƒ±r olduqda
                video.onloadedmetadata = () => {
                    video.play();
                    
                    // Canvas √∂l√ß√ºl…ôrini t…ôyin et
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    
                    statusText.textContent = 'Kamera aktivdir';
                    cameraInfo.textContent = √ñl√ß√º: ${video.videoWidth} x ${video.videoHeight};
                    
                    // Hand Tracking qur
                    setupHandTracking();
                    
                    // Animasiyaya ba≈üla
                    startProcessing();
                };
                
            } catch (error) {
                console.error('Kamera x…ôtasƒ±:', error);
                
                if (error.name === 'NotAllowedError') {
                    statusText.textContent = 'X…ôta: Kamera icaz…ôsi verilm…ôdi!';
                    alert('Kamera icaz…ôsi verilm…ôdi! Brauzerin √ºnvan √ßubuƒüundakƒ± kamera ikonasƒ±ndan icaz…ô verin.');
                } else if (error.name === 'NotFoundError') {
                    statusText.textContent = 'X…ôta: Kamera tapƒ±lmadƒ±!';
                    alert('Kamera tapƒ±lmadƒ±! Z…ôhm…ôt olmasa kameranƒ±zƒ± qo≈üun.');
                } else {
                    statusText.textContent = 'X…ôta: ' + error.message;
                    alert('Kamera x…ôtasƒ±: ' + error.message);
                }
            }
        }

        // ========== HAND TRACKING QUR ==========
        function setupHandTracking() {
            try {
                hands = new Hands({
                    locateFile: (file) => {
                        return https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1675469241/${file};
                    }
                });

                hands.setOptions({
                    maxNumHands: 1,
                    modelComplexity: 0,  // Daha s√ºr…ôtli √º√ß√ºn 0
                    minDetectionConfidence: 0.5,
                    minTrackingConfidence: 0.5
                });

                hands.onResults(onHandResults);
                
                statusText.textContent = 'Hand Tracking aktiv';
                
            } catch (error) {
                console.error('Hand Tracking x…ôtasƒ±:', error);
                statusText.textContent = 'Hand Tracking qurula bilm…ôdi';
            }
        }

        // ========== FRAME-L∆èRƒ∞ ƒ∞≈ûL∆è ==========
        function startProcessing() {
            if (!isCameraActive) {
                isCameraActive = true;
                processFrame();
            }
        }

        async function processFrame() {
            if (!isCameraActive || !hands || !video.videoWidth) {
                return;
            }
            
            try {
                await hands.send({ image: video });
            } catch (error) {
                console.error('Frame i≈ül…ôm…ô x…ôtasƒ±:', error);
            }
            
            // N√∂vb…ôti frame
            animationFrame = requestAnimationFrame(processFrame);
        }

        // ========== HAND TRACKING N∆èTƒ∞C∆èL∆èRƒ∞ ==========
        function onHandResults(results) {
            // Canvas-ƒ± t…ômizl…ô
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Videonu canvas-a √ß…ôk (aynalama √º√ß√ºn)
            ctx.save();
            ctx.scale(-1, 1);
            ctx.translate(-canvas.width, 0);
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            ctx.restore();
            
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                // ∆èl tapƒ±ldƒ±
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText('üëÜ ∆èl tapƒ±ldƒ±!', 20, 40);
                
                // ∆èl n√∂qt…ôl…ôrini √ß…ôk
                drawHandLandmarks(results.multiHandLandmarks[0]);
            } else {
                // ∆èl tapƒ±lmadƒ±
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.fillText('‚úã ∆èlinizi g√∂st…ôrin', 20, 40);
            }
        }

        // ========== ∆èL N√ñQT∆èL∆èRƒ∞Nƒ∞ √á∆èK ==========
        function drawHandLandmarks(landmarks) {
            if (!landmarks) return;
            
            // Baƒülantƒ±larƒ± √ß…ôk
            ctx.save();
            ctx.scale(-1, 1);
            ctx.translate(-canvas.width, 0);
            
            // Baƒülantƒ±lar
            ctx.strokeStyle = '#00ff00';
            ctx.lineWidth = 3;
            
            const connections = [
                [0, 1], [1, 2], [2, 3], [3, 4],  // Ba≈ü barmaq
                [0, 5], [5, 6], [6, 7], [7, 8],  // ƒ∞≈üar…ô barmaƒüƒ±
                [0, 9], [9, 10], [10, 11], [11, 12],  // Orta barmaq
                [0, 13], [13, 14], [14, 15], [15, 16],  // √úz√ºk barmaq
                [0, 17], [17, 18], [18, 19], [19, 20],  // √áe√ß…ôl…ô
                [0, 5], [5, 9], [9, 13], [13, 17]  // Ovuc
            ];
            
            ctx.beginPath();
            connections.forEach(conn => {
                const start = landmarks[conn[0]];
                const end = landmarks[conn[1]];
                
                if (start && end) {
                    ctx.moveTo(start.x * canvas.width, start.y * canvas.height);
                    ctx.lineTo(end.x * canvas.width, end.y * canvas.height);
                }
            });
            ctx.stroke();
            
            // N√∂qt…ôl…ôri √ß…ôk
            landmarks.forEach((point, index) => {
                const x = point.x * canvas.width;
                const y = point.y * canvas.height;
                
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, 2 * Math.PI);
                
                // Barmaq uclarƒ± qƒ±rmƒ±zƒ±
                if ([4, 8, 12, 16, 20].includes(index)) {
                    ctx.fillStyle = '#ff0000';
                    ctx.shadowColor = '#ff0000';
                } else {
                    ctx.fillStyle = '#00ff00';
                    ctx.shadowColor = '#00ff00';
                }
                
                ctx.shadowBlur = 10;
                ctx.fill();
            });
            
            ctx.restore();
        }

        // ========== KAMERANI DAYANDIR ==========
        function stopCamera() {
            isCameraActive = false;
            
            if (animationFrame) {
                cancelAnimationFrame(animationFrame);
                animationFrame = null;
            }
            
            if (video.srcObject) {
                const tracks = video.srcObject.getTracks();
                tracks.forEach(track => track.stop());
                video.srcObject = null;
            }
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            statusText.textContent = 'Kamera dayandƒ±';
            cameraInfo.textContent = '';
        }

        // ========== ≈û∆èKƒ∞L √á∆èK ==========
        function captureImage() {
            if (!video.srcObject) {
                alert('Kamera aktiv deyil!');
                return;
            }
            
            // Canvas-da ≈ü…ôkli √ß…ôk
            const captureCanvas = document.createElement('canvas');
            captureCanvas.width = video.videoWidth;
            captureCanvas.height = video.videoHeight;
            const captureCtx = captureCanvas.getContext('2d');
            
            // Aynalama il…ô √ß…ôk
            captureCtx.save();
            captureCtx.scale(-1, 1);
            captureCtx.translate(-captureCanvas.width, 0);
            captureCtx.drawImage(video, 0, 0, captureCanvas.width, captureCanvas.height);
            captureCtx.restore();
            
            // Y√ºkl…ô
            const link = document.createElement('a');
            link.download = sekil-${Date.now()}.png;
            link.href = captureCanvas.toDataURL();
            link.click();
        }

        // S…ôhif…ô baƒülananda kameranƒ± dayandƒ±r
        window.addEventListener('beforeunload', stopCamera);
    </script>
</body>
</html>
